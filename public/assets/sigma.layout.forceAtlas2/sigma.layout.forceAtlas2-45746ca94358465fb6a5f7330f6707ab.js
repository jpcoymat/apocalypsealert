!function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";var t=sigma.utils.pkg("sigma.layout.forceatlas2");t.ForceAtlas2=function(i,a){var e=this;this.graph=i,this.p=sigma.utils.extend(a||{},t.defaultSettings),this.state={step:0,index:0},this.init=function(){return e.state={step:0,index:0},e.graph.nodes().forEach(function(t){t.fa2={mass:1+e.graph.degree(t.id),old_dx:0,old_dy:0,dx:0,dy:0}}),e},this.go=function(){for(;e.atomicGo(););},this.atomicGo=function(){var i,a,n,s,o,f,r,d=e.graph,h=d.nodes,c=d.edges,l=h(),p=c(),u=e.p.complexIntervals,g=e.p.simpleIntervals;switch(e.state.step){case 0:for(i=0,s=l.length;s>i;i++)a=l[i],a.fa2=a.fa2?{mass:1+e.graph.degree(a.id),old_dx:a.fa2.dx||0,old_dy:a.fa2.dy||0,dx:0,dy:0}:{mass:1+e.graph.degree(a.id),old_dx:0,old_dy:0,dx:0,dy:0};if(e.p.barnesHutOptimize&&(e.rootRegion=new t.Region(l,0),e.rootRegion.buildSubRegions()),e.p.outboundAttractionDistribution){for(e.p.outboundAttCompensation=0,i=0,s=l.length;s>i;i++)a=l[i],e.p.outboundAttCompensation+=a.fa2.mass;e.p.outboundAttCompensation/=l.length}return e.state.step=1,e.state.index=0,!0;case 1:var y,x,m,_,v,M,b=e.ForceFactory.buildRepulsion(e.p.adjustSizes,e.p.scalingRatio);if(e.p.barnesHutOptimize){for(v=e.rootRegion,M=e.p.barnesHutTheta,i=e.state.index;i<l.length&&i<e.state.index+u;)(a=l[i++]).fa2&&v.applyForce(a,b,M);i===l.length?e.state={step:2,index:0}:e.state.index=i}else{for(m=e.state.index;m<l.length&&m<e.state.index+u;)if((y=l[m++]).fa2)for(_=0;m>_;_++)(x=l[_]).fa2&&b.apply_nn(y,x);m===l.length?e.state={step:2,index:0}:e.state.index=m}return!0;case 2:var A=e.p.strongGravityMode?e.ForceFactory.getStrongGravity(e.p.scalingRatio):e.ForceFactory.buildRepulsion(e.p.adjustSizes,e.p.scalingRatio),w=e.p.gravity,R=e.p.scalingRatio;for(i=e.state.index;i<l.length&&i<e.state.index+g;)a=l[i++],a.fa2&&A.apply_g(a,w/R);return i===l.length?e.state={step:3,index:0}:e.state.index=i,!0;case 3:var C=e.ForceFactory.buildAttraction(e.p.linLogMode,e.p.outboundAttractionDistribution,e.p.adjustSizes,e.p.outboundAttractionDistribution?e.p.outboundAttCompensation:1);if(i=e.state.index,0===e.p.edgeWeightInfluence)for(;i<p.length&&i<e.state.index+u;)n=p[i++],C.apply_nn(h(n.source),h(n.target),1);else if(1===e.p.edgeWeightInfluence)for(;i<p.length&&i<e.state.index+u;)n=p[i++],C.apply_nn(h(n.source),h(n.target),n.weight||1);else for(;i<p.length&&i<e.state.index+u;)n=p[i++],C.apply_nn(h(n.source),h(n.target),Math.pow(n.weight||1,e.p.edgeWeightInfluence));return i===p.length?e.state={step:4,index:0}:e.state.index=i,!0;case 4:var q,S,F=0,z=0;for(i=0,s=l.length;s>i;i++)a=l[i],o=a.fixed||!1,!o&&a.fa2&&(f=Math.sqrt(Math.pow(a.fa2.old_dx-a.fa2.dx,2)+Math.pow(a.fa2.old_dy-a.fa2.dy,2)),F+=a.fa2.mass*f,z+=.5*a.fa2.mass*Math.sqrt(Math.pow(a.fa2.old_dx+a.fa2.dx,2)+Math.pow(a.fa2.old_dy+a.fa2.dy,2)));for(e.p.totalSwinging=F,e.p.totalEffectiveTraction=z,S=Math.pow(e.p.jitterTolerance,2)*e.p.totalEffectiveTraction/e.p.totalSwinging,q=.5,e.p.speed=e.p.speed+Math.min(S-e.p.speed,q*e.p.speed),i=0,s=l.length;s>i;i++)a=l[i],a.old_x=+a.x,a.old_y=+a.y;return e.state.step=5,!0;case 5:var E,D;if(i=e.state.index,e.p.adjustSizes)for(D=e.p.speed;i<l.length&&i<e.state.index+g;)a=l[i++],o=a.fixed||!1,!o&&a.fa2&&(f=Math.sqrt((a.fa2.old_dx-a.fa2.dx)*(a.fa2.old_dx-a.fa2.dx)+(a.fa2.old_dy-a.fa2.dy)*(a.fa2.old_dy-a.fa2.dy)),r=.1*D/(1+D*Math.sqrt(f)),E=Math.sqrt(Math.pow(a.fa2.dx,2)+Math.pow(a.fa2.dy,2)),r=Math.min(r*E,10)/E,a.x+=a.fa2.dx*r,a.y+=a.fa2.dy*r);else for(D=e.p.speed;i<l.length&&i<e.state.index+g;)a=l[i++],o=a.fixed||!1,!o&&a.fa2&&(f=Math.sqrt((a.fa2.old_dx-a.fa2.dx)*(a.fa2.old_dx-a.fa2.dx)+(a.fa2.old_dy-a.fa2.dy)*(a.fa2.old_dy-a.fa2.dy)),r=D/(1+D*Math.sqrt(f)),a.x+=a.fa2.dx*r,a.y+=a.fa2.dy*r);return i===l.length?(e.state={step:0,index:0},!1):(e.state.index=i,!0);default:throw new Error("ForceAtlas2 - atomic state error")}},this.clean=function(){var t,i=this.graph.nodes(),a=i.length;for(t=0;a>t;t++)delete i[t].fa2},this.setAutoSettings=function(){var t=this.graph;return this.p.scalingRatio=t.nodes().length>=100?2:10,this.p.strongGravityMode=!1,this.p.gravity=1,this.p.outboundAttractionDistribution=!1,this.p.linLogMode=!1,this.p.adjustSizes=!1,this.p.edgeWeightInfluence=1,this.p.jitterTolerance=t.nodes().length>=5e4?10:t.nodes().length>=5e3?1:.1,this.p.barnesHutOptimize=t.nodes().length>=1e3?!0:!1,this.p.barnesHutTheta=1.2,this},this.kill=function(){},this.ForceFactory={buildRepulsion:function(t,i){return t?new this.linRepulsion_antiCollision(i):new this.linRepulsion(i)},getStrongGravity:function(t){return new this.strongGravity(t)},buildAttraction:function(t,i,a,e){return a?t?i?new this.logAttraction_degreeDistributed_antiCollision(e):new this.logAttraction_antiCollision(e):i?new this.linAttraction_degreeDistributed_antiCollision(e):new this.linAttraction_antiCollision(e):t?i?new this.logAttraction_degreeDistributed(e):new this.logAttraction(e):i?new this.linAttraction_massDistributed(e):new this.linAttraction(e)},linRepulsion:function(t){this.coefficient=t,this.apply_nn=function(t,i){if(t.fa2&&i.fa2){var a=t.x-i.x,e=t.y-i.y,n=Math.sqrt(a*a+e*e);if(n>0){var s=this.coefficient*t.fa2.mass*i.fa2.mass/Math.pow(n,2);t.fa2.dx+=a*s,t.fa2.dy+=e*s,i.fa2.dx-=a*s,i.fa2.dy-=e*s}}},this.apply_nr=function(t,i){var a=t.x-i.p.massCenterX,e=t.y-i.p.massCenterY,n=Math.sqrt(a*a+e*e);if(n>0){var s=this.coefficient*t.fa2.mass*i.p.mass/Math.pow(n,2);t.fa2.dx+=a*s,t.fa2.dy+=e*s}},this.apply_g=function(t,i){var a=t.x,e=t.y,n=Math.sqrt(a*a+e*e);if(n>0){var s=this.coefficient*t.fa2.mass*i/n;t.fa2.dx-=a*s,t.fa2.dy-=e*s}}},linRepulsion_antiCollision:function(t){this.coefficient=t,this.apply_nn=function(t,i){var a;if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=Math.sqrt(e*e+n*n)-t.size-i.size;s>0?(a=this.coefficient*t.fa2.mass*i.fa2.mass/Math.pow(s,2),t.fa2.dx+=e*a,t.fa2.dy+=n*a,i.fa2.dx-=e*a,i.fa2.dy-=n*a):0>s&&(a=100*this.coefficient*t.fa2.mass*i.fa2.mass,t.fa2.dx+=e*a,t.fa2.dy+=n*a,i.fa2.dx-=e*a,i.fa2.dy-=n*a)}},this.apply_nr=function(t,i){var a,e=t.fa2.x()-i.getMassCenterX(),n=t.fa2.y()-i.getMassCenterY(),s=Math.sqrt(e*e+n*n);s>0?(a=this.coefficient*t.fa2.mass*i.getMass()/Math.pow(s,2),t.fa2.dx+=e*a,t.fa2.dy+=n*a):0>s&&(a=-this.coefficient*t.fa2.mass*i.getMass()/s,t.fa2.dx+=e*a,t.fa2.dy+=n*a)},this.apply_g=function(t,i){var a=t.x,e=t.y,n=Math.sqrt(a*a+e*e);if(n>0){var s=this.coefficient*t.fa2.mass*i/n;t.fa2.dx-=a*s,t.fa2.dy-=e*s}}},strongGravity:function(t){this.coefficient=t,this.apply_nn=function(){},this.apply_nr=function(){},this.apply_g=function(t,i){var a=t.x,e=t.y,n=Math.sqrt(a*a+e*e);if(n>0){var s=this.coefficient*t.fa2.mass*i;t.fa2.dx-=a*s,t.fa2.dy-=e*s}}},linAttraction:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=-this.coefficient*a;t.fa2.dx+=e*s,t.fa2.dy+=n*s,i.fa2.dx-=e*s,i.fa2.dy-=n*s}}},linAttraction_massDistributed:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=-this.coefficient*a/t.fa2.mass;t.fa2.dx+=e*s,t.fa2.dy+=n*s,i.fa2.dx-=e*s,i.fa2.dy-=n*s}}},logAttraction:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=Math.sqrt(e*e+n*n);if(s>0){var o=-this.coefficient*a*Math.log(1+s)/s;t.fa2.dx+=e*o,t.fa2.dy+=n*o,i.fa2.dx-=e*o,i.fa2.dy-=n*o}}}},logAttraction_degreeDistributed:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=Math.sqrt(e*e+n*n);if(s>0){var o=-this.coefficient*a*Math.log(1+s)/s/t.fa2.mass;t.fa2.dx+=e*o,t.fa2.dy+=n*o,i.fa2.dx-=e*o,i.fa2.dy-=n*o}}}},linAttraction_antiCollision:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=Math.sqrt(e*e+n*n);if(s>0){var o=-this.coefficient*a;t.fa2.dx+=e*o,t.fa2.dy+=n*o,i.fa2.dx-=e*o,i.fa2.dy-=n*o}}}},linAttraction_degreeDistributed_antiCollision:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=Math.sqrt(e*e+n*n);if(s>0){var o=-this.coefficient*a/t.fa2.mass;t.fa2.dx+=e*o,t.fa2.dy+=n*o,i.fa2.dx-=e*o,i.fa2.dy-=n*o}}}},logAttraction_antiCollision:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=Math.sqrt(e*e+n*n);if(s>0){var o=-this.coefficient*a*Math.log(1+s)/s;t.fa2.dx+=e*o,t.fa2.dy+=n*o,i.fa2.dx-=e*o,i.fa2.dy-=n*o}}}},logAttraction_degreeDistributed_antiCollision:function(t){this.coefficient=t,this.apply_nn=function(t,i,a){if(t.fa2&&i.fa2){var e=t.x-i.x,n=t.y-i.y,s=Math.sqrt(e*e+n*n);if(s>0){var o=-this.coefficient*a*Math.log(1+s)/s/t.fa2.mass;t.fa2.dx+=e*o,t.fa2.dy+=n*o,i.fa2.dx-=e*o,i.fa2.dy-=n*o}}}}}},t.Region=function(t,i){this.depthLimit=20,this.size=0,this.nodes=t,this.subregions=[],this.depth=i,this.p={mass:0,massCenterX:0,massCenterY:0},this.updateMassAndGeometry()},t.Region.prototype.updateMassAndGeometry=function(){if(this.nodes.length>1){var t=0,i=0,a=0;this.nodes.forEach(function(e){t+=e.fa2.mass,i+=e.x*e.fa2.mass,a+=e.y*e.fa2.mass});var e,n=i/t,s=a/t;this.nodes.forEach(function(t){var i=Math.sqrt((t.x-n)*(t.x-n)+(t.y-s)*(t.y-s));e=Math.max(e||2*i,2*i)}),this.p.mass=t,this.p.massCenterX=n,this.p.massCenterY=s,this.size=e}},t.Region.prototype.buildSubRegions=function(){if(this.nodes.length>1){var i,a,e,n,s=[],o=[],f=[],r=this.p.massCenterX,d=this.p.massCenterY,h=this.depth+1,c=this,l=[],p=[],u=[],g=[];this.nodes.forEach(function(t){i=t.x<r?s:o,i.push(t)}),s.forEach(function(t){a=t.y<d?l:p,a.push(t)}),o.forEach(function(t){a=t.y<d?g:u,a.push(t)}),[l,p,u,g].filter(function(t){return t.length}).forEach(function(i){h<=c.depthLimit&&i.length<c.nodes.length?(n=new t.Region(i,h),f.push(n)):i.forEach(function(i){e=[i],n=new t.Region(e,h),f.push(n)})}),this.subregions=f,f.forEach(function(t){t.buildSubRegions()})}},t.Region.prototype.applyForce=function(t,i,a){if(this.nodes.length<2){var e=this.nodes[0];i.apply_nn(t,e)}else{var n=Math.sqrt((t.x-this.p.massCenterX)*(t.x-this.p.massCenterX)+(t.y-this.p.massCenterY)*(t.y-this.p.massCenterY));n*a>this.size?i.apply_nr(t,this):this.subregions.forEach(function(e){e.applyForce(t,i,a)})}},sigma.prototype.startForceAtlas2=function(i){function a(){conrad.hasJob("forceatlas2_"+e.id)||conrad.addJob({id:"forceatlas2_"+e.id,job:e.forceatlas2.atomicGo,end:function(){e.refresh(),e.forceatlas2.isRunning&&a()}})}if((this.forceatlas2||{}).isRunning)return this;this.forceatlas2||(this.forceatlas2=new t.ForceAtlas2(this.graph,i||{}),this.forceatlas2.p.autoSettings&&this.forceatlas2.setAutoSettings(),this.forceatlas2.init()),this.forceatlas2.isRunning=!0;var e=this;return a(),this},sigma.prototype.stopForceAtlas2=function(){return(this.forceatlas2||{}).isRunning&&(this.forceatlas2.state={step:0,index:0},this.forceatlas2.isRunning=!1,this.forceatlas2.clean()),conrad.hasJob("forceatlas2_"+this.id)&&conrad.killJob("forceatlas2_"+this.id),this},t.defaultSettings={autoSettings:!0,linLogMode:!1,outboundAttractionDistribution:!1,adjustSizes:!1,edgeWeightInfluence:0,scalingRatio:1,strongGravityMode:!1,gravity:1,jitterTolerance:1,barnesHutOptimize:!1,barnesHutTheta:1.2,speed:1,outboundAttCompensation:1,totalSwinging:0,totalEffectiveTraction:0,complexIntervals:500,simpleIntervals:1e3}}();