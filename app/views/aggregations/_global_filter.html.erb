<h3>Quick Filter <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#fullFilter">Pop</button></h3>
<ul class="nav nav-pills nav-stacked">
<% @global_filter.filter_elements.each do |filter_element| %>
  <li><%= select_tag filter_element.element_name, options_from_collection_for_select(filter_element.filter_options, "id", "name"), multiple: filter_element.multiselectable, class: 'form-control chosen-select', data: {placeholder: filter_element.display_name} %></li>
<% end %>
<li><button type="submit" class="btn btn-primary" onclick="javacript:refreshData()">Refresh</button></li>
</ul>

<div id="fullFilter" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">Filter Options</h4>
	      </div>
	      <div class="modal-body">
	        <form class="form-horizontal">
					<% @global_filter.filter_elements.each do |filter_element| %>
					  <div class="form-group">
						  <%= label_tag filter_element.element_name, filter_element.display_name, class: "col-xs-3 control-label" %>
						  <div class="col-xs-5">
					      <%= select_tag filter_element.element_name, options_from_collection_for_select(filter_element.filter_options, "id", "name"), multiple: filter_element.multiselectable, class: 'form-control chosen-select', id: "pop-"+filter_element.element_name, data: {placeholder: ''} %>
					    </div>
					    <div class="checkbox" >
						    <label>
							    <input type="checkbox" id="chbx-<%= filter_element.element_name %>">
							  </label>
							</div>
					  </div>
					<% end %>
	        </form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary" data-dismiss="modal">Filter</button>
	        <button type="button" class="btn btn-primary">Filter and Save</button>
	      </div>
	    </div>
	  </div>
</div>


<script type="text/javascript" charset="utf-8">
	<% @global_filter.filter_elements.each do |filter_element| %>
	  $("#<%= filter_element.element_name %>").chosen({search_contains: true});
	  $("#pop-<%= filter_element.element_name %>").chosen({search_contains: true, width: '100%'});
	  <% if filter_element.enabled_for_quick_filter %>
	    $("#chbx-<%= filter_element.element_name %>").prop('checked', true);
	  <% end %>
	<% end %>
	
	function refreshData() {
		var parameters = [];
		<% @global_filter.filter_elements.each do |filter_element|  %>
		  parameters.push({'<%= filter_element.element_name %>': $("#<%= filter_element.element_name %>").val()}); 
		<% end %>
    var url = "/aggregations/refresh_global?"
    parameters.forEach( function(arrayItem) {
	    var parameter_key =   Object.keys(arrayItem)[0];
	    var parameter_value = arrayItem[parameter_key];
	    if (parameter_value !== null) {
		    url +=  parameter_key + "=" + parameter_value + "&"
 	    }
    }); 
	  $.get(url, function(data){
		  console.log(data);
	  });
	  
	}
	
</script>

	