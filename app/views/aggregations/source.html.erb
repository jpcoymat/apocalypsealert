<% content_for :head do %>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<% end %>

<h1>Source View</h1>
<div class="container">
		<label>View Attribute</label> 
	  <select id="attribute_view">
		  <option value="quantity">Quantity</option>
		  <option value="cost">Cost</option>
	  </select>
</div>
<div id="source_view" style="min-width: 310px; height: 600px; margin: 0 auto"></div>
<script type="text/javascript">
$(function () {
    $('#source_view').highcharts({
	      chart: {
				  type: 'column',
				  marginBottom: 120
				},
        title: {
          text: 'Source Phase Summary'
        },
        xAxis: {
          categories: seriesObject = serverData[group_by].chart_categories,
					title: {text: "Product Categories"}
        },
        yAxis: {
				  min: 0,
				  title: {
				    text: 'Total Quantity'
				  },
				  stackLabels: {
					  enabled: true,
					  style: {
						  fontWeight: 'bold',
							color:  'gray'
						}
				  }
				},
				legend: {
					floating: true,
					backgroundColor: 'white',
					borderColor: '#CCC',
					borderWidth: 1,
					shadow: false
				},
				tooltip: {
				  formatter: function () {
					  return '<b>' + this.x + '</b><br/>' + this.series.name + ': ' + this.y + '<br/>' + 'Total: ' + this.point.stackTotal;
					}
			  },	
        series: createSeriesArray(),
        plotOptions: {
					series: {
		        stacking: 'normal',
            cursor: 'pointer'
	        },	        
		      column: {
            stacking: 'normal',
            dataLabels: {
	            enabled: true,
	            color:  'white',
	            style: {
		            textShadow: '0 0 3px black'
	            }
            }			
 		      }
        }
    });

	  $('#view_type').change(function() {
      var page1 = $('.page1');
      var page2 = $('.page2');
      var toHide = page1.is(':visible') ? page1 : page2;
      var toShow = page2.is(':visible') ? page1 : page2;
         
      toHide.removeClass('flip in').addClass('flip out').hide();
      toShow.removeClass('flip out').addClass('flip in').show();
    });

});

function createSeriesArray(){
	
	var seriesObject = serverData[group_by].series;
	var seriesArray = [];
  for (series in seriesObject) {
	  var single_series = seriesObject[series];
  	seriesArray.push({name: single_series.name, data: single_series.data[attribute_view]});
  };	
  console.log(seriesArray);
  return seriesArray;
	
}


</script>

